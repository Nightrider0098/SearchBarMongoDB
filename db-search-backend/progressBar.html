<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <label for="file">Downloading progress:</label>
    <progress id="progressBar" value="0" max="100"> loadings </progress>
    <div id="data"></div>

</body>

<script>
    setTimeout(() => {
        StartSearch()
    }, 1000);

    var current_query = 0;
    var dbName = 'emp2'
    var dbLength = 0;
    const xhttp = new XMLHttpRequest()
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {

            var wholeData = JSON.parse(xhttp.response)
            if (wholeData.id == 1) {
                // alert('update came')
                // document.getElementById('data').innerHTML = JSON.stringify(wholeData.data)
                dbLength = wholeData.dbLength
                document.getElementById('progressBar').value = 10
                StartContinue()
            }
            else if (wholeData.id == 2) {

                // alert('update came 2')
                // document.getElementById('data').innerHTML = document.getElementById('data').innerHTML + JSON.stringify(wholeData.data)
                document.getElementById('progressBar').value += 10
                StartContinue()
            }
        }
    }
    function StartSearch() {
        // var sql_query = 'index=2&dbName=emp2&dbLength=10400'
        xhttp.open('get', '/SearchBig')
        xhttp.send()
    }
    function StartContinue() {
        current_query += 1;
        if (current_query < 10) {
            var sql_query = 'index=' + current_query + '&dbName=' + dbName + '&dbLength=10400'
            // alert('sending contiune')
            xhttp.open('get', '/SearchBigContinue?' + sql_query)
            xhttp.send()
        }
    }
</script>

</html>